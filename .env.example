# === NEAR Environment Configuration Template ===
# Copy this file to .env (for sandbox) or .env.testnet (for testnet)
# Then customize with your account details

# =============================================================================
# SANDBOX CONFIGURATION (Local Development)
# =============================================================================

# Environment
NEAR_ENV=sandbox

# Master Account (shared sandbox signer for this project)
MASTER_ACCOUNT=service.test.near
MASTER_ACCOUNT_PRIVATE_KEY=ed25519:4o4Q6FRGGGVAmZVzywvqyiZMmCVaQxQ8WEwBNWaGJ6Yy
# Multiple keys for high throughput (minimum 5 keys recommended for 100+ TPS)
MASTER_ACCOUNT_PRIVATE_KEYS=ed25519:4o4Q6FRGGGVAmZVzywvqyiZMmCVaQxQ8WEwBNWaGJ6Yy,ed25519:A8K3RyCt67FtKhGQt1awzHiALiQWRTRUMn5rsrtAADgJ,ed25519:GLGmJHj9tRfMbmmFfEiNQd5KVnBb8i9RkJzaMf955797,ed25519:5JKWKkqkqk5L9vYdGzYzYzYzYzYzYzYzYzYzYzYz,ed25519:6LMXMlrlrl6M0wZeHaHaHaHaHaHaHaHaHaHaHaHa
# Limit concurrent tx per key (8 recommended for @eclipseeer/near-api-ts)
SANDBOX_MAX_IN_FLIGHT_PER_KEY=8


# FT Contract (deployed for the shared sandbox account)
FT_CONTRACT=service.test.near

# RPC Configuration (local sandbox)
NODE_URL=http://127.0.0.1:3030
PORT=3000

# =============================================================================
# TESTNET CONFIGURATION (Production Testing)
# =============================================================================

# Environment
# NEAR_ENV=testnet

# Master Account (your testnet account with FT contract)
# Replace with your actual testnet account details
# MASTER_ACCOUNT=your-account.testnet
# MASTER_ACCOUNT_PRIVATE_KEY=ed25519:your-private-key-here
# MASTER_ACCOUNT_PRIVATE_KEYS=ed25519:your-primary-key,ed25519:your-secondary-key

# FT Contract (deployed NEP-141 FT contract on testnet)
# FT_CONTRACT=your-ft-contract.testnet

# RPC Configuration (testnet with FastNEAR for performance)
# NODE_URL=https://rpc.testnet.near.org
# RPC_URLS=https://rpc.testnet.near.org,https://rpc.testnet.fastnear.com/?apiKey=YOUR_FASTNEAR_API_KEY
# FASTNEAR_API_KEY=YOUR_FASTNEAR_API_KEY

# =============================================================================
# COMMON SETTINGS (Apply to both environments)
# =============================================================================

# API Configuration
# PORT=3000

# Service Performance Settings - Optimized for 100+ TPS
# ========================================================
# Skip storage checks for maximum throughput (pre-register receivers)
SKIP_STORAGE_CHECK=true
STORAGE_MIN_DEPOSIT=1250000000000000000000

# Concurrency & Connection Pool
CONCURRENCY_LIMIT=600           # Maximum concurrent requests
MAX_IN_FLIGHT=200              # Maximum in-flight transactions
WORKER_COUNT=8                  # Number of worker processes

# Throttle Settings for 100+ TPS Target
# With 5 keys @ 30 TPS each = 150 TPS capacity (30% margin)
MAX_TX_PER_SECOND=150          # Global throttle (TPS capacity with margin)
GLOBAL_THROTTLE_WINDOW_SEC=1   # Window for global throttle
MAX_TX_PER_KEY_PER_SECOND=30   # Per-key throttle (30 TPS per key)
PER_KEY_THROTTLE_WINDOW_SEC=1  # Window for per-key throttle

# Key Pool Configuration
SANDBOX_MAX_IN_FLIGHT_PER_KEY=8    # Concurrent tx per sandbox key
TESTNET_MAX_IN_FLIGHT_PER_KEY=8    # Concurrent tx per testnet key
MAX_IN_FLIGHT_PER_KEY=8            # Fallback for any environment

# Transaction Finality (Included = fastest, Final = most reliable)
WAIT_UNTIL=Included

# Batch Processing
BATCH_SIZE=50                   # Batch size for request processing
QUEUE_SIZE=25000               # Maximum queue size

# Server Configuration
SERVER_TIMEOUT_MS=120000       # 2 minutes
REQUEST_TIMEOUT_MS=120000      # 2 minutes

# =============================================================================
# SETUP INSTRUCTIONS
# =============================================================================

# For Sandbox (Local Development):
# 1. Copy this file to .env
# 2. Start near-sandbox (or use near-ft-helper for automated setup)
# 3. Generate multiple keys for high throughput:
#    - Use near account add-key or let near-ft-helper generate them
#    - Minimum 5 keys recommended for 100+ TPS target
# 4. Bootstrap receivers and pre-register storage:
#    node ci/bootstrap-sandbox-accounts.mjs
# 5. Run API + Worker: npm run start:sandbox & npm run run:worker:sandbox
# 6. Load test: ./testing/artillery/run-artillery-test.sh sandbox

# For Testnet (Production Testing):
# 1. Copy this file to .env.testnet
# 2. Uncomment and customize testnet configuration above
# 3. Generate 5+ keys for your master account:
#    near account add-key <your-account.testnet> --allowanceGrant
# 4. Add all keys to MASTER_ACCOUNT_PRIVATE_KEYS (comma-separated)
# 5. Fund account with sufficient NEAR for gas
# 6. Run: npm run start:testnet
# 7. Load test: ./testing/artillery/run-artillery-test.sh testnet

# Performance Tips:
# - Use SKIP_STORAGE_CHECK=true and pre-register all receivers
# - Increase key count for higher TPS (5 keys = 150 TPS capacity)
# - Monitor nonce conflicts; increase MAX_IN_FLIGHT_PER_KEY if needed
# - Use WAIT_UNTIL=Included for maximum speed (Included > ExecutedOptimistic > Final)

# Security Note:
# - Never commit private keys to version control
# - Use environment-specific configurations
# - Testnet requires real NEAR tokens for gas fees